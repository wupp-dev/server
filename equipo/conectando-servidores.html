<!DOCTYPE html>
<html lang="es-ES" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Conectando varios servidores | WUPP</title>
    <meta name="description" content="Guía del servidor.">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/server/assets/style.B9WejEw8.css" as="style">
    <link rel="preload stylesheet" href="/server/vp-icons.css" as="style">
    
    <script type="module" src="/server/assets/app.Cbm8vKcv.js"></script>
    <link rel="preload" href="/server/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/server/assets/chunks/theme.DLE97ksL.js">
    <link rel="modulepreload" href="/server/assets/chunks/framework.DOQiNUXs.js">
    <link rel="modulepreload" href="/server/assets/equipo_conectando-servidores.md.Zcp3qL6g.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-9b0b86e8><!--[--><!--]--><!--[--><span tabindex="-1" data-v-081b41b1></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-081b41b1>Skip to content</a><!--]--><!----><header class="VPNav" data-v-9b0b86e8 data-v-5e911cba><div class="VPNavBar" data-v-5e911cba data-v-113b5d97><div class="wrapper" data-v-113b5d97><div class="container" data-v-113b5d97><div class="title" data-v-113b5d97><div class="VPNavBarTitle has-sidebar" data-v-113b5d97 data-v-098a7d51><a class="title" href="/server/" data-v-098a7d51><!--[--><!--]--><!----><span data-v-098a7d51>WUPP</span><!--[--><!--]--></a></div></div><div class="content" data-v-113b5d97><div class="content-body" data-v-113b5d97><!--[--><!--]--><div class="VPNavBarSearch search" data-v-113b5d97><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-113b5d97 data-v-f1143b6c><span id="main-nav-aria-label" class="visually-hidden" data-v-f1143b6c> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/server/" tabindex="0" data-v-f1143b6c data-v-6d568d15><!--[--><span data-v-6d568d15>Inicio</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/server/equipo/historia.html" tabindex="0" data-v-f1143b6c data-v-6d568d15><!--[--><span data-v-6d568d15>Guía del servidor</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/wupp-dev/server" target="_blank" rel="noreferrer" tabindex="0" data-v-f1143b6c data-v-6d568d15><!--[--><span data-v-6d568d15>Archivos de configuración</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-113b5d97 data-v-3f38a08c><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f38a08c data-v-b6094026 data-v-f27e40f9><span class="check" data-v-f27e40f9><span class="icon" data-v-f27e40f9><!--[--><span class="vpi-sun sun" data-v-b6094026></span><span class="vpi-moon moon" data-v-b6094026></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-113b5d97 data-v-e3273194 data-v-a5d5a902><!--[--><a class="VPSocialLink no-icon" href="https://discord.gg/2pdbaf6Ugz" aria-label="discord" target="_blank" rel="noopener" data-v-a5d5a902 data-v-f1cb951a><span class="vpi-social-discord"></span></a><a class="VPSocialLink no-icon" href="https://github.com/wupp-dev/" aria-label="github" target="_blank" rel="noopener" data-v-a5d5a902 data-v-f1cb951a><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-113b5d97 data-v-14a89329 data-v-165130db><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-165130db><span class="vpi-more-horizontal icon" data-v-165130db></span></button><div class="menu" data-v-165130db><div class="VPMenu" data-v-165130db data-v-bb72934a><!----><!--[--><!--[--><!----><div class="group" data-v-14a89329><div class="item appearance" data-v-14a89329><p class="label" data-v-14a89329>Appearance</p><div class="appearance-action" data-v-14a89329><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-14a89329 data-v-b6094026 data-v-f27e40f9><span class="check" data-v-f27e40f9><span class="icon" data-v-f27e40f9><!--[--><span class="vpi-sun sun" data-v-b6094026></span><span class="vpi-moon moon" data-v-b6094026></span><!--]--></span></span></button></div></div></div><div class="group" data-v-14a89329><div class="item social-links" data-v-14a89329><div class="VPSocialLinks social-links-list" data-v-14a89329 data-v-a5d5a902><!--[--><a class="VPSocialLink no-icon" href="https://discord.gg/2pdbaf6Ugz" aria-label="discord" target="_blank" rel="noopener" data-v-a5d5a902 data-v-f1cb951a><span class="vpi-social-discord"></span></a><a class="VPSocialLink no-icon" href="https://github.com/wupp-dev/" aria-label="github" target="_blank" rel="noopener" data-v-a5d5a902 data-v-f1cb951a><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-113b5d97 data-v-de11878a><span class="container" data-v-de11878a><span class="top" data-v-de11878a></span><span class="middle" data-v-de11878a></span><span class="bottom" data-v-de11878a></span></span></button></div></div></div></div><div class="divider" data-v-113b5d97><div class="divider-line" data-v-113b5d97></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-9b0b86e8 data-v-74ab4557><div class="container" data-v-74ab4557><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-74ab4557><span class="vpi-align-left menu-icon" data-v-74ab4557></span><span class="menu-text" data-v-74ab4557>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-74ab4557 data-v-953d0dbe><button data-v-953d0dbe>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-9b0b86e8 data-v-404a3ae5><div class="curtain" data-v-404a3ae5></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-404a3ae5><span class="visually-hidden" id="sidebar-aria-label" data-v-404a3ae5> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-9825a890><section class="VPSidebarItem level-0 has-active" data-v-9825a890 data-v-16c43b71><div class="item" role="button" tabindex="0" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><h2 class="text" data-v-16c43b71>Equipo</h2><!----></div><div class="items" data-v-16c43b71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/equipo/historia.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Historia</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/equipo/hardware.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Hardware</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/equipo/sistema-encriptado.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Instalación del SO encriptado</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/equipo/router-dominio.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Configuración del router y dominio</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/equipo/gestion-remota.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Gestión remota con SSH y VNC</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/equipo/nginx.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Nginx como servidor web</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/equipo/docker.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Docker</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/equipo/mariadb-docker.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Configurando MariaDB con Docker</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/equipo/monitorizacion.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Monitorizando el equipo y los servicios</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/equipo/conectando-servidores.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Conectando varios servidores</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9825a890><section class="VPSidebarItem level-0" data-v-9825a890 data-v-16c43b71><div class="item" role="button" tabindex="0" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><h2 class="text" data-v-16c43b71>Servicios</h2><!----></div><div class="items" data-v-16c43b71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/servicios/nextcloud.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Nextcloud - Almacenamiento</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/servicios/mailserver.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Docker Mailserver - Correo electrónico</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/servicios/minio.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Minio - Almacenamiento S3</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/servicios/minecraft.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Minecraft con AMP</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/servicios/dozzle.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Dozzle - Visualizador de logs</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/servicios/homarr.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Homarr - Dashboard</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/servicios/uptime-kuma.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Uptime Kuma - Status</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/servicios/authentik.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Authentik - Autenticación</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/servicios/gogs.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Gitea - Servicio git</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/servicios/navidrome.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Navidrome - Streaming de música</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/servicios/sharelatex.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Overleaf - Editor de LaTeX</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9825a890><section class="VPSidebarItem level-0" data-v-9825a890 data-v-16c43b71><div class="item" role="button" tabindex="0" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><h2 class="text" data-v-16c43b71>Relatos</h2><!----></div><div class="items" data-v-16c43b71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/relatos/bloqueo-ssh.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Bloqueo de SSH</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/relatos/docker.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Docker y sus cosas</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/relatos/dns-initramfs.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Resolución de dominios en initramfs</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-16c43b71 data-v-16c43b71><div class="item" data-v-16c43b71><div class="indicator" data-v-16c43b71></div><a class="VPLink link link" href="/server/relatos/tunel-ssh-ulp.html" data-v-16c43b71><!--[--><p class="text" data-v-16c43b71>Túnel SSH en la UGR LAN Party de 2024</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-9b0b86e8 data-v-e94661f2><div class="VPDoc has-sidebar has-aside" data-v-e94661f2 data-v-2ba199be><!--[--><!--]--><div class="container" data-v-2ba199be><div class="aside" data-v-2ba199be><div class="aside-curtain" data-v-2ba199be></div><div class="aside-container" data-v-2ba199be><div class="aside-content" data-v-2ba199be><div class="VPDocAside" data-v-2ba199be data-v-948b7903><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-948b7903 data-v-eadc5369><div class="content" data-v-eadc5369><div class="outline-marker" data-v-eadc5369></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-eadc5369>On this page</div><ul class="VPDocOutlineItem root" data-v-eadc5369 data-v-ae41b8fd><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-948b7903></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-2ba199be><div class="content-container" data-v-2ba199be><!--[--><!--]--><main class="main" data-v-2ba199be><div style="position:relative;" class="vp-doc _server_equipo_conectando-servidores" data-v-2ba199be><div><h1 id="conectando-varios-servidores" tabindex="-1">Conectando varios servidores <a class="header-anchor" href="#conectando-varios-servidores" aria-label="Permalink to &quot;Conectando varios servidores&quot;">​</a></h1><p>Llega un momento en el que un ordenador se queda corto, sobre todo si quieres usarlo para Minecraft. Así que nuestra solución fue añadir otro a la colección pero, ¿cómo conectamos ambos para que respondan bajo un mismo dominio?</p><h2 id="introduccion" tabindex="-1">Introducción <a class="header-anchor" href="#introduccion" aria-label="Permalink to &quot;Introducción&quot;">​</a></h2><p>Lo primero que tendremos que hacer con el nuevo ordenador es seguir toda esta guía para llegar a tenerlo en un punto usable. Eso sí, tendremos que escoger dos nuevos puertos para OpenSSH Server y Dropbear, pero por lo demás es todo igual hasta que llegamos a Nginx. Que no se nos olvide asignarle una IP local fija que, asumiremos que es <code>192.168.1.144</code>. Si hacemos referenci a la IP local del servidor principal, asumiremos también que es <code>192.168.1.133</code>.</p><h2 id="nginx" tabindex="-1">Nginx <a class="header-anchor" href="#nginx" aria-label="Permalink to &quot;Nginx&quot;">​</a></h2><p>Llegados a este punto, lo ideal sería tener un tercer ordenador (como una Raspberry) con Nginx para gestionar las conexiones y que simplemente haga de proxy inverso hacia los otros ordenadores, que tendrán los distintos servicios.</p><p>Como no nos sobra el dinero para tener todavía otro más, hemos optado por seguir usando el ordenador principal para gestionar las conexiones y que el de Minecraft simplemente se comunique con el otro y no con el exterior (salvo por el SSH).</p><h3 id="internet-servidor-principal" tabindex="-1">Internet &lt;-&gt; Servidor principal <a class="header-anchor" href="#internet-servidor-principal" aria-label="Permalink to &quot;Internet &lt;-&gt; Servidor principal&quot;">​</a></h3><p>Para empezar tenemos que configurar Nginx para que lo único que haga al recibir una solicitud que deba de ir al ordenador secundario sea gestionar la conexión HTTPS y comunicarse con el ordenador secundario. En nuestro caso queremos redirigir los subdominios <code>mc.wupp.dev</code> y <code>amp.wupp.dev</code> (entre otros) al servidor secundario para servir NamelessMC y el panel de control de Minecraft respectivamente.</p><p>El archivo de configuración de Nginx para los dos dominios debería de quedar igual. Este sería el de <code>amp.wupp.dev</code> por ejemplo:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">amp.wupp.dev;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">https://192.168.1.144;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_ssl_session_reuse </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_ssl_verify </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">off</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Host $host;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Forwarded-Proto $scheme;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ssl; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ssl_certificate </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/letsencrypt/live/amp.wupp.dev/fullchain.pem; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ssl_certificate_key </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/letsencrypt/live/amp.wupp.dev/privkey.pem; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/letsencrypt/options-ssl-nginx.conf; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ssl_dhparam </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/letsencrypt/ssl-dhparams.pem; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Aunque las opciones <code>proxy_ssl_session_reuse on;</code> y <code>proxy_ssl_verify off;</code> ya tienen esos valores por defecto, he preferido especificarlas para tenerlas más en cuenta. La primera lo que hace es reutilizar los parámetros del SSL handshake para que las conexiones requieran menos recursos al establecerse. La segunda le indica a Nginx que no debe indicar si el certificado del ordenador secundario es válido, pues utilizaremos uno <em>self-signed</em> para facilitar las cosas (y esos no se consideran válidos tal cual).</p><h3 id="servidor-principal-servidor-secundario" tabindex="-1">Servidor principal &lt;-&gt; Servidor secundario <a class="header-anchor" href="#servidor-principal-servidor-secundario" aria-label="Permalink to &quot;Servidor principal &lt;-&gt; Servidor secundario&quot;">​</a></h3><p>En el servidor secundario, a parte de instalar Nginx y configurarlo tal y como dice esta guía, hay que modificar <code>/etc/nginx/nginx.conf</code> para quitar todas las líneas de configuración de <em>OSCP stapling</em>, pues entre el ordenador principal y el secundario no será necesario usarlo.</p><p>Debian debería venir con un paquete llamado <code>ssl-cert</code> que genera un certificado <em>self-signed</em> al instalarse, así que también deberíamos tener un certificado en <code>/etc/ssl/certs/ssl-cert-snakeoil.pem</code> que será el que usaremos para que la conexión entre el servidor principal y el secundario pueda ser por HTTPS.</p><p>Para usarlo, simplemente debemos incluirlo en el archivo de configuración como si se tratase del certificado de certbot:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ssl;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_certificate </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/ssl/certs/ssl-cert-snakeoil.pem;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_certificate_key </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/ssl/private/ssl-cert-snakeoil.key;</span></span></code></pre></div><h2 id="correo-electronico" tabindex="-1">Correo electrónico <a class="header-anchor" href="#correo-electronico" aria-label="Permalink to &quot;Correo electrónico&quot;">​</a></h2><p>Si nos hemos decidido a configurar un servidor de correo en el ordenador principal, se nos puede dar el caso en el que un servicio del ordenador secundario necesite mandar correos a través del servidor de correo que hayamos configurado.</p><p>Para asegurar que funcione correctamente, utilizaremos y configuraremos <code>exim4</code> en el servidor secundario. Empezamos instalándolo con <code>sudo apt-get install exim4-daemon-light</code> y pasamos a configurarlo editando <code>sudo nano /etc/exim4/update-exim4.conf.conf</code>. Para nuestro caso concreto:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># /etc/exim4/update-exim4.conf.conf</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># Edit this file and /etc/mailname by hand and execute update-exim4.conf</span></span>
<span class="line"><span># yourself or use &#39;dpkg-reconfigure exim4-config&#39;</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># Please note that this is _not_ a dpkg-conffile and that automatic changes</span></span>
<span class="line"><span># to this file might happen. The code handling this will honor your local</span></span>
<span class="line"><span># changes, so this is usually fine, but will break local schemes that mess</span></span>
<span class="line"><span># around with multiple versions of the file.</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># update-exim4.conf uses this file to determine variable values to generate</span></span>
<span class="line"><span># exim configuration macros for the configuration file.</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># Most settings found in here do have corresponding questions in the</span></span>
<span class="line"><span># Debconf configuration, but not all of them.</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># This is a Debian specific file</span></span>
<span class="line"><span></span></span>
<span class="line"><span>dc_eximconfig_configtype=&#39;satellite&#39;</span></span>
<span class="line"><span>dc_other_hostnames=&#39;mcserver&#39;</span></span>
<span class="line"><span>dc_local_interfaces=&#39;127.0.0.1 ; ::1&#39;</span></span>
<span class="line"><span>dc_readhost=&#39;wupp.dev&#39;</span></span>
<span class="line"><span>dc_relay_domains=&#39;&#39;</span></span>
<span class="line"><span>dc_minimaldns=&#39;false&#39;</span></span>
<span class="line"><span>dc_relay_nets=&#39;&#39;</span></span>
<span class="line"><span>dc_smarthost=&#39;192.168.1.133:587&#39;</span></span>
<span class="line"><span>CFILEMODE=&#39;644&#39;</span></span>
<span class="line"><span>dc_use_split_config=&#39;false&#39;</span></span>
<span class="line"><span>dc_hide_mailname=&#39;true&#39;</span></span>
<span class="line"><span>dc_mailname_in_oh=&#39;true&#39;</span></span>
<span class="line"><span>dc_localdelivery=&#39;mail_spool&#39;</span></span></code></pre></div><p>donde <code>192.168.1.133:587</code> es la IP local del ordenador principal y el puerto donde esté ESMTP con STARTTLS.</p><p>También editamos <code>sudo nano /etc/exim4/passwd.client</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># password file used when the local exim is authenticating to a remote</span></span>
<span class="line"><span># host as a client.</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># see exim4_passwd_client(5) for more documentation</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># Example:</span></span>
<span class="line"><span>### target.mail.server.example:login:password</span></span>
<span class="line"><span>*:admin@wupp.dev:passw</span></span></code></pre></div><p>donde <code>admin@wupp.dev</code> y <code>passw</code> es un correo y su contraseña del ordenador principal.</p><p>Aplicamos los cambios con <code>sudo update-exim4.conf</code> y con <code>sudo /etc/init.d/exim4 restart</code>.</p><p>Esto nos permitirá que, mandando correos desde el servidor secundario a sí mismo al puerto 25, se redirijan al servidor principal y salgan desde allí.</p></div></div></main><footer class="VPDocFooter" data-v-2ba199be data-v-d8b94513><!--[--><!--]--><div class="edit-info" data-v-d8b94513><!----><div class="last-updated" data-v-d8b94513><p class="VPLastUpdated" data-v-d8b94513 data-v-2e599d61>Actualizado por última vez: <time datetime="2023-08-05T16:51:40.000Z" data-v-2e599d61></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-d8b94513><span class="visually-hidden" id="doc-footer-aria-label" data-v-d8b94513>Pager</span><div class="pager" data-v-d8b94513><a class="VPLink link pager-link prev" href="/server/equipo/monitorizacion.html" data-v-d8b94513><!--[--><span class="desc" data-v-d8b94513>Previous page</span><span class="title" data-v-d8b94513>Monitorizando el equipo y los servicios</span><!--]--></a></div><div class="pager" data-v-d8b94513><a class="VPLink link pager-link next" href="/server/servicios/nextcloud.html" data-v-d8b94513><!--[--><span class="desc" data-v-d8b94513>Next page</span><span class="title" data-v-d8b94513>Nextcloud - Almacenamiento</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-9b0b86e8 data-v-ace1d418><div class="container" data-v-ace1d418><p class="message" data-v-ace1d418>Distribuido bajo la licencia CC BY.</p><p class="copyright" data-v-ace1d418>Copyright © 2022-presente Lucas de Uña Ocampo e Iván Salido Cobo</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"equipo_conectando-servidores.md\":\"Zcp3qL6g\",\"equipo_docker.md\":\"CcgMaLLS\",\"equipo_gestion-remota.md\":\"DFNSrW2b\",\"equipo_hardware.md\":\"Csc9ViFp\",\"equipo_historia.md\":\"CG0PJkan\",\"equipo_mariadb-docker.md\":\"DIGqPKlR\",\"equipo_monitorizacion.md\":\"BhzFtwCc\",\"equipo_nginx.md\":\"C2lJbw1s\",\"equipo_router-dominio.md\":\"PiD9dRxw\",\"equipo_sistema-encriptado.md\":\"D1m5hZaU\",\"index.md\":\"DwPkHm1p\",\"relatos_bloqueo-ssh.md\":\"BBvsoiTY\",\"relatos_dns-initramfs.md\":\"CKhXzK6K\",\"relatos_docker.md\":\"DfDGe-zT\",\"relatos_tunel-ssh-ulp.md\":\"BwU5M3Xw\",\"servicios_authentik.md\":\"DXgJwAR6\",\"servicios_dozzle.md\":\"Dm6G5sKJ\",\"servicios_gitea.md\":\"CzJ97vs2\",\"servicios_homarr.md\":\"DGIArpFj\",\"servicios_mailserver.md\":\"BNIS-Eq9\",\"servicios_minecraft.md\":\"CLW9bShx\",\"servicios_minio.md\":\"B5wYaK11\",\"servicios_navidrome.md\":\"BlSLwShw\",\"servicios_nextcloud.md\":\"jnNmc8YW\",\"servicios_sharelatex.md\":\"DGJM8OGI\",\"servicios_uptime-kuma.md\":\"BOU-nT4_\",\"shared_servicios_puertos.md\":\"VelsIgCs\",\"shared_servicios_recordatorios-nginx.md\":\"BxyclM__\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"es-ES\",\"dir\":\"ltr\",\"title\":\"WUPP\",\"description\":\"Guía del servidor.\",\"base\":\"/server/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"lastUpdatedText\":\"Actualizado por última vez\",\"nav\":[{\"text\":\"Inicio\",\"link\":\"/\",\"activeMatch\":\"\"},{\"text\":\"Guía del servidor\",\"link\":\"/equipo/historia\",\"activeMatch\":\"/(equipo|servicios)/\"},{\"text\":\"Archivos de configuración\",\"link\":\"https://github.com/wupp-dev/server\"}],\"socialLinks\":[{\"icon\":\"discord\",\"link\":\"https://discord.gg/2pdbaf6Ugz\"},{\"icon\":\"github\",\"link\":\"https://github.com/wupp-dev/\"}],\"sidebar\":{\"/equipo/\":[{\"text\":\"Equipo\",\"collapsible\":true,\"items\":[{\"text\":\"Historia\",\"link\":\"/equipo/historia\"},{\"text\":\"Hardware\",\"link\":\"/equipo/hardware\"},{\"text\":\"Instalación del SO encriptado\",\"link\":\"/equipo/sistema-encriptado\"},{\"text\":\"Configuración del router y dominio\",\"link\":\"/equipo/router-dominio\"},{\"text\":\"Gestión remota con SSH y VNC\",\"link\":\"/equipo/gestion-remota\"},{\"text\":\"Nginx como servidor web\",\"link\":\"/equipo/nginx\"},{\"text\":\"Docker\",\"link\":\"/equipo/docker\"},{\"text\":\"Configurando MariaDB con Docker\",\"link\":\"/equipo/mariadb-docker\"},{\"text\":\"Monitorizando el equipo y los servicios\",\"link\":\"/equipo/monitorizacion\"},{\"text\":\"Conectando varios servidores\",\"link\":\"/equipo/conectando-servidores\"}]},{\"text\":\"Servicios\",\"collapsible\":true,\"items\":[{\"text\":\"Nextcloud - Almacenamiento\",\"link\":\"/servicios/nextcloud\"},{\"text\":\"Docker Mailserver - Correo electrónico\",\"link\":\"/servicios/mailserver\"},{\"text\":\"Minio - Almacenamiento S3\",\"link\":\"/servicios/minio\"},{\"text\":\"Minecraft con AMP\",\"link\":\"/servicios/minecraft\"},{\"text\":\"Dozzle - Visualizador de logs\",\"link\":\"/servicios/dozzle\"},{\"text\":\"Homarr - Dashboard\",\"link\":\"/servicios/homarr\"},{\"text\":\"Uptime Kuma - Status\",\"link\":\"/servicios/uptime-kuma\"},{\"text\":\"Authentik - Autenticación\",\"link\":\"/servicios/authentik\"},{\"text\":\"Gitea - Servicio git\",\"link\":\"/servicios/gogs\"},{\"text\":\"Navidrome - Streaming de música\",\"link\":\"/servicios/navidrome\"},{\"text\":\"Overleaf - Editor de LaTeX\",\"link\":\"/servicios/sharelatex\"}]},{\"text\":\"Relatos\",\"collapsible\":true,\"items\":[{\"text\":\"Bloqueo de SSH\",\"link\":\"/relatos/bloqueo-ssh\"},{\"text\":\"Docker y sus cosas\",\"link\":\"/relatos/docker\"},{\"text\":\"Resolución de dominios en initramfs\",\"link\":\"/relatos/dns-initramfs\"},{\"text\":\"Túnel SSH en la UGR LAN Party de 2024\",\"link\":\"/relatos/tunel-ssh-ulp\"}]}],\"/servicios/\":[{\"text\":\"Equipo\",\"collapsible\":true,\"items\":[{\"text\":\"Historia\",\"link\":\"/equipo/historia\"},{\"text\":\"Hardware\",\"link\":\"/equipo/hardware\"},{\"text\":\"Instalación del SO encriptado\",\"link\":\"/equipo/sistema-encriptado\"},{\"text\":\"Configuración del router y dominio\",\"link\":\"/equipo/router-dominio\"},{\"text\":\"Gestión remota con SSH y VNC\",\"link\":\"/equipo/gestion-remota\"},{\"text\":\"Nginx como servidor web\",\"link\":\"/equipo/nginx\"},{\"text\":\"Docker\",\"link\":\"/equipo/docker\"},{\"text\":\"Configurando MariaDB con Docker\",\"link\":\"/equipo/mariadb-docker\"},{\"text\":\"Monitorizando el equipo y los servicios\",\"link\":\"/equipo/monitorizacion\"},{\"text\":\"Conectando varios servidores\",\"link\":\"/equipo/conectando-servidores\"}]},{\"text\":\"Servicios\",\"collapsible\":true,\"items\":[{\"text\":\"Nextcloud - Almacenamiento\",\"link\":\"/servicios/nextcloud\"},{\"text\":\"Docker Mailserver - Correo electrónico\",\"link\":\"/servicios/mailserver\"},{\"text\":\"Minio - Almacenamiento S3\",\"link\":\"/servicios/minio\"},{\"text\":\"Minecraft con AMP\",\"link\":\"/servicios/minecraft\"},{\"text\":\"Dozzle - Visualizador de logs\",\"link\":\"/servicios/dozzle\"},{\"text\":\"Homarr - Dashboard\",\"link\":\"/servicios/homarr\"},{\"text\":\"Uptime Kuma - Status\",\"link\":\"/servicios/uptime-kuma\"},{\"text\":\"Authentik - Autenticación\",\"link\":\"/servicios/authentik\"},{\"text\":\"Gitea - Servicio git\",\"link\":\"/servicios/gogs\"},{\"text\":\"Navidrome - Streaming de música\",\"link\":\"/servicios/navidrome\"},{\"text\":\"Overleaf - Editor de LaTeX\",\"link\":\"/servicios/sharelatex\"}]},{\"text\":\"Relatos\",\"collapsible\":true,\"items\":[{\"text\":\"Bloqueo de SSH\",\"link\":\"/relatos/bloqueo-ssh\"},{\"text\":\"Docker y sus cosas\",\"link\":\"/relatos/docker\"},{\"text\":\"Resolución de dominios en initramfs\",\"link\":\"/relatos/dns-initramfs\"},{\"text\":\"Túnel SSH en la UGR LAN Party de 2024\",\"link\":\"/relatos/tunel-ssh-ulp\"}]}],\"/relatos/\":[{\"text\":\"Equipo\",\"collapsible\":true,\"items\":[{\"text\":\"Historia\",\"link\":\"/equipo/historia\"},{\"text\":\"Hardware\",\"link\":\"/equipo/hardware\"},{\"text\":\"Instalación del SO encriptado\",\"link\":\"/equipo/sistema-encriptado\"},{\"text\":\"Configuración del router y dominio\",\"link\":\"/equipo/router-dominio\"},{\"text\":\"Gestión remota con SSH y VNC\",\"link\":\"/equipo/gestion-remota\"},{\"text\":\"Nginx como servidor web\",\"link\":\"/equipo/nginx\"},{\"text\":\"Docker\",\"link\":\"/equipo/docker\"},{\"text\":\"Configurando MariaDB con Docker\",\"link\":\"/equipo/mariadb-docker\"},{\"text\":\"Monitorizando el equipo y los servicios\",\"link\":\"/equipo/monitorizacion\"},{\"text\":\"Conectando varios servidores\",\"link\":\"/equipo/conectando-servidores\"}]},{\"text\":\"Servicios\",\"collapsible\":true,\"items\":[{\"text\":\"Nextcloud - Almacenamiento\",\"link\":\"/servicios/nextcloud\"},{\"text\":\"Docker Mailserver - Correo electrónico\",\"link\":\"/servicios/mailserver\"},{\"text\":\"Minio - Almacenamiento S3\",\"link\":\"/servicios/minio\"},{\"text\":\"Minecraft con AMP\",\"link\":\"/servicios/minecraft\"},{\"text\":\"Dozzle - Visualizador de logs\",\"link\":\"/servicios/dozzle\"},{\"text\":\"Homarr - Dashboard\",\"link\":\"/servicios/homarr\"},{\"text\":\"Uptime Kuma - Status\",\"link\":\"/servicios/uptime-kuma\"},{\"text\":\"Authentik - Autenticación\",\"link\":\"/servicios/authentik\"},{\"text\":\"Gitea - Servicio git\",\"link\":\"/servicios/gogs\"},{\"text\":\"Navidrome - Streaming de música\",\"link\":\"/servicios/navidrome\"},{\"text\":\"Overleaf - Editor de LaTeX\",\"link\":\"/servicios/sharelatex\"}]},{\"text\":\"Relatos\",\"collapsible\":true,\"items\":[{\"text\":\"Bloqueo de SSH\",\"link\":\"/relatos/bloqueo-ssh\"},{\"text\":\"Docker y sus cosas\",\"link\":\"/relatos/docker\"},{\"text\":\"Resolución de dominios en initramfs\",\"link\":\"/relatos/dns-initramfs\"},{\"text\":\"Túnel SSH en la UGR LAN Party de 2024\",\"link\":\"/relatos/tunel-ssh-ulp\"}]}]},\"footer\":{\"message\":\"Distribuido bajo la licencia CC BY.\",\"copyright\":\"Copyright © 2022-presente Lucas de Uña Ocampo e Iván Salido Cobo\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>