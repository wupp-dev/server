<!DOCTYPE html>
<html lang="es-ES" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx como servidor web | Servidor mamad√≠simo</title>
    <meta name="description" content="Gu√≠a del servidor.">
    <link rel="preload stylesheet" href="/server/assets/style.26af2e74.css" as="style">
    
    <script type="module" src="/server/assets/app.bb8b625b.js"></script>
    <link rel="preload" href="/server/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/server/assets/chunks/framework.3d7dc540.js">
    <link rel="modulepreload" href="/server/assets/chunks/theme.63f3287b.js">
    <link rel="modulepreload" href="/server/assets/equipo_nginx.md.dbed93a5.lean.js">
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-1919c326><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-1919c326 data-v-7e5bc4a5><div class="VPNavBar has-sidebar" data-v-7e5bc4a5 data-v-a0fd61f4><div class="container" data-v-a0fd61f4><div class="title" data-v-a0fd61f4><div class="VPNavBarTitle has-sidebar" data-v-a0fd61f4 data-v-86d1bed8><a class="title" href="/server/" data-v-86d1bed8><!--[--><!--]--><!----><!--[-->Servidor mamad√≠simo<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a0fd61f4><div class="curtain" data-v-a0fd61f4></div><div class="content-body" data-v-a0fd61f4><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-a0fd61f4><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a0fd61f4 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/server/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>Inicio</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/server/equipo/historia.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>Gu√≠a del servidor</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/wupp-dev/server" target="_blank" rel="noreferrer" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>Archivos de configuraci√≥n</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a0fd61f4 data-v-f6a63727><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-f6a63727 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a0fd61f4 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://discord.gg/2pdbaf6Ugz" aria-label="discord" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Discord</title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a0fd61f4 data-v-40855f84 data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-40855f84><div class="item social-links" data-v-40855f84><div class="VPSocialLinks social-links-list" data-v-40855f84 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://discord.gg/2pdbaf6Ugz" aria-label="discord" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Discord</title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a0fd61f4 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-1919c326 data-v-79c8c1df><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-79c8c1df><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-79c8c1df><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-79c8c1df>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-79c8c1df data-v-1c15a60a><button data-v-1c15a60a>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-1919c326 data-v-b00e2fdd><div class="curtain" data-v-b00e2fdd></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-b00e2fdd><span class="visually-hidden" id="sidebar-aria-label" data-v-b00e2fdd> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 has-active" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>Equipo</h2><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/equipo/historia.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Historia</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/equipo/hardware.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Hardware</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/equipo/sistema-encriptado.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Instalaci√≥n del SO encriptado</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/equipo/router-dominio.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Configuraci√≥n del router y dominio</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/equipo/gestion-remota.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Gesti√≥n remota con SSH y VNC</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/equipo/nginx.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Nginx como servidor web</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/equipo/docker.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Docker</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/equipo/mariadb-docker.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Configurando MariaDB con Docker</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/equipo/conectando-servidores.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Conectando varios servidores</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>Servicios</h2><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/servicios/nextcloud.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Nextcloud - Almacenamiento</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/servicios/mailserver.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Docker Mailserver - Correo electr√≥nico</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/servicios/minio.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Minio - Almacenamiento S3</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/servicios/minecraft.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Minecraft con AMP</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/servicios/dozzle.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Dozzle - Visualizador de logs</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/servicios/homarr.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Homarr - Dashboard</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/servicios/uptime-kuma.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Uptime Kuma - Status</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/servicios/authentik.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Authentik - Autenticaci√≥n</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/servicios/gogs.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Gitea - Servicio git</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/servicios/navidrome.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Navidrome - Streaming de m√∫sica</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/servicios/sharelatex.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Overleaf - Editor de LaTeX</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/servicios/docker-mailserver.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Docker Mailserver - Servidor de correo</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>Relatos</h2><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/relatos/bloqueo-ssh.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Bloqueo de SSH</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/relatos/usuario-docker.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Lucas vs. Debian & Docker & etc.</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/server/relatos/dns-initramfs.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Resoluci√≥n de dominios en initramfs</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-1919c326 data-v-669faec9><div class="VPDoc has-sidebar has-aside" data-v-669faec9 data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-6ae8e080><div class="content" data-v-6ae8e080><div class="outline-marker" data-v-6ae8e080></div><div class="outline-title" role="heading" data-v-6ae8e080>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-6ae8e080><span class="visually-hidden" id="doc-outline-aria-label" data-v-6ae8e080> Table of Contents for current page </span><ul class="root" data-v-6ae8e080 data-v-d0ee3533><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _server_equipo_nginx" data-v-6b87e69f><div><h1 id="nginx-como-servidor-web" tabindex="-1">Nginx como servidor web <a class="header-anchor" href="#nginx-como-servidor-web" aria-label="Permalink to &quot;Nginx como servidor web&quot;">‚Äã</a></h1><p>Ya nos hemos encargado de poder acceder al servidor remotamente, pero eso es solo para nosotros, queda la parte m√°s importante, el poder ofrecer alg√∫n tipo de servicio <em>(como puede ser una p√°gina web)</em>.</p><p>Para ello, necesitamos un servidor web, que se encargar√° de gestionar las conexiones entrantes. Existen dos bastante famosos:</p><ul><li><a href="https://httpd.apache.org/" target="_blank" rel="noreferrer">Apache</a></li><li><a href="https://www.nginx.com/" target="_blank" rel="noreferrer">Nginx</a></li></ul><p>Nosotros usaremos Nginx por ser m√°s moderno y m√°s eficiente.</p><div class="warning custom-block"><p class="custom-block-title">ATENCI√ìN</p><p>En esta gu√≠a se utilizan varios ajustes que mejoran la seguridad del servidor, pero esto reduce la compatibilidad con dispositivos antiguos y navegadores desactualizados, que no podr√°n acceder a la p√°gina. Nosotros hemos decidido que es m√°s importante garantizar la seguridad a la retrocompatibilidad, pero esto depender√° de cada caso.</p></div><h2 id="instalacion-y-puesta-en-marcha" tabindex="-1">Instalaci√≥n y puesta en marcha <a class="header-anchor" href="#instalacion-y-puesta-en-marcha" aria-label="Permalink to &quot;Instalaci√≥n y puesta en marcha&quot;">‚Äã</a></h2><p>Para asegurarnos de tener la √∫ltima versi√≥n siempre instalada, utilizaremos los repositorios de Nginx en vez de los del sistema operativo. Para a√±adirlos, podemos seguir los pasos de <a href="https://nginx.org/en/linux_packages.html#Debian" target="_blank" rel="noreferrer">su web</a>, que para Debian son:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gnupg2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ca-certificates</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lsb-release</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">debian-archive-keyring</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://nginx.org/keys/nginx_signing.key</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">gpg</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dearmor</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tee</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/share/keyrings/nginx-archive-keyring.gpg</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/dev/null</span></span>
<span class="line"><span style="color:#B392F0;">gpg</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dry-run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--quiet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--import</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--import-options</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">import-show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/share/keyrings/nginx-archive-keyring.gpg</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">curl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gnupg2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ca-certificates</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lsb-release</span><span style="color:#24292E;"> </span><span style="color:#032F62;">debian-archive-keyring</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://nginx.org/keys/nginx_signing.key</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">gpg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dearmor</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tee</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/share/keyrings/nginx-archive-keyring.gpg</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/dev/null</span></span>
<span class="line"><span style="color:#6F42C1;">gpg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dry-run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--quiet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--import</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--import-options</span><span style="color:#24292E;"> </span><span style="color:#032F62;">import-show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/share/keyrings/nginx-archive-keyring.gpg</span></span></code></pre></div><p>Con este √∫ltimo comando verificamos que la clave es la correcta, deber√≠a mostrarse lo siguiente:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">pub</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">rsa2048</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2011</span><span style="color:#9ECBFF;">-08-19</span><span style="color:#E1E4E8;"> [SC] [expires: </span><span style="color:#79B8FF;">2024</span><span style="color:#E1E4E8;">-06-14]</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62</span></span>
<span class="line"><span style="color:#B392F0;">uid</span><span style="color:#E1E4E8;">                      </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">signing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">signing-key@nginx.co</span><span style="color:#E1E4E8;">m</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">pub</span><span style="color:#24292E;">   </span><span style="color:#032F62;">rsa2048</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2011</span><span style="color:#032F62;">-08-19</span><span style="color:#24292E;"> [SC] [expires: </span><span style="color:#005CC5;">2024</span><span style="color:#24292E;">-06-14]</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62</span></span>
<span class="line"><span style="color:#6F42C1;">uid</span><span style="color:#24292E;">                      </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">signing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">signing-key@nginx.co</span><span style="color:#24292E;">m</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>Nosotros hemos escogido usar los paquetes <strong>mainline</strong> en vez de los <strong>stable</strong>, la diferencia es que los primeros contienen las √∫ltimas novedades aunque pueden ser menos estables por tener caracter√≠sticas experimentales. Para a√±adir el repositorio mainline, utilizamos el siguiente comando:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] </span><span style="color:#79B8FF;">\</span></span>
<span class="line"><span style="color:#9ECBFF;">    http://nginx.org/packages/mainline/debian `</span><span style="color:#B392F0;">lsb_release</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-cs</span><span style="color:#9ECBFF;">` nginx&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tee</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/apt/sources.list.d/nginx.list</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#032F62;">    http://nginx.org/packages/mainline/debian `</span><span style="color:#6F42C1;">lsb_release</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-cs</span><span style="color:#032F62;">` nginx&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tee</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/apt/sources.list.d/nginx.list</span></span></code></pre></div><p>Y ya ha llegado el momento de instalar Nginx:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span></span></code></pre></div><p>Una vez instalado, podemos iniciarlo y verificar que est√° funcionando correctamente:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span></span></code></pre></div><p>Sin embargo, queda un √∫ltimo paso, abrir los puertos <code>80</code> y <code>443</code> tanto en el router como en el firewall, para el firewall escribimos:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ufw</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">allow</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ufw</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">allow</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">443</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ufw</span><span style="color:#24292E;"> </span><span style="color:#032F62;">allow</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ufw</span><span style="color:#24292E;"> </span><span style="color:#032F62;">allow</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">443</span></span></code></pre></div><p>Estos son los puertos de HTTP y HTTPS respectivamente.</p><p>Vamos a toquetear un poco la configuraci√≥n para las partes venideras de la gu√≠a. La configuraci√≥n de Nginx se estructura en bloques. Concretamente la parte que tocaremos son los bloques <code>server</code>, que ser√°n la configuraci√≥n de cada uno de nuestros subdominios. Estos archivos de configuraci√≥n se guardan en <code>/etc/nginx/conf.d/</code> y, por defecto, solo habr√° un archivo llamado <code>default.conf</code>, vamos a cambiarle el nombre a <code>www.wupp.dev</code>, ya que tendr√° el bloque encargado de gestionar las conexiones con esa URL.</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/nginx/conf.d/default.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/nginx/conf.d/www.wupp.dev.conf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/nginx/conf.d/default.conf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/nginx/conf.d/www.wupp.dev.conf</span></span></code></pre></div><p>Editamos el archivo buscando una l√≠nea que empiece por <code>server_name</code>:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">server_name </span><span style="color:#E1E4E8;">wupp.dev www.wupp.dev;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">server_name </span><span style="color:#24292E;">wupp.dev www.wupp.dev;</span></span></code></pre></div><p>Ahora dejamos que Nginx verifique la sintaxis del archivo y, si no hay problemas, los reiniciamos:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span></span>
<span class="line"><span style="color:#6A737D;"># nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span></span>
<span class="line"><span style="color:#6A737D;"># nginx: configuration file /etc/nginx/nginx.conf test is successful</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">reload</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span></span>
<span class="line"><span style="color:#6A737D;"># nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span></span>
<span class="line"><span style="color:#6A737D;"># nginx: configuration file /etc/nginx/nginx.conf test is successful</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">reload</span></span></code></pre></div><h2 id="habilitando-y-forzando-https" tabindex="-1">Habilitando <em>(y forzando)</em> HTTPS <a class="header-anchor" href="#habilitando-y-forzando-https" aria-label="Permalink to &quot;Habilitando _(y forzando)_ HTTPS&quot;">‚Äã</a></h2><p>Ahora mismo podemos poner en el navegador <a href="http://wupp.dev/" target="_blank" rel="noreferrer">wupp.dev</a>, pero la conexi√≥n no es segura üò¶</p><p>Eso es inadmisible, as√≠ que vamos a forzar a que todas las conexiones HTTP se redirijan a HTTPS. Hemos seguido <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-20-04-es" target="_blank" rel="noreferrer">este tutorial</a>.</p><p>Vamos a utilizar Certbot, un software para gestionar los certificados de Let&#39;s Encrypt, que son <a href="https://es.wikipedia.org/wiki/Autoridad_de_certificaci%C3%B3n" target="_blank" rel="noreferrer">certificados de autoridad</a> gratuitos.</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certbot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">python3-certbot-nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certbot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">python3-certbot-nginx</span></span></code></pre></div><p>Generamos el certificado para nuestro dominio:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certbot</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--key-type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ecdsa</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--elliptic-curve</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secp384r1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">wupp.dev</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">www.wupp.dev</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certbot</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--key-type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ecdsa</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--elliptic-curve</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secp384r1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">wupp.dev</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">www.wupp.dev</span></span></code></pre></div><p>Hemos especificado <code>--key-type ecdsa</code> porque</p><p>Y ya est√°, certbot se encarga de modificar la configuraci√≥n del archivo <code>/etc/nginx/conf.d/www.wupp.dev.conf</code> para forzar el uso de HTTPS y para renovar autom√°ticamente los certificados cuando vayan a expirar.</p><h2 id="otras-mejoras-de-seguridad" tabindex="-1">Otras mejoras de seguridad <a class="header-anchor" href="#otras-mejoras-de-seguridad" aria-label="Permalink to &quot;Otras mejoras de seguridad&quot;">‚Äã</a></h2><p>Aunque ya hemos asegurado que la conexi√≥n al servidor sea por HTTPS, aun quedan unos cuantos cambios por hacer para mejorar la seguridad.</p><p>Antes hemos mencionado que la configuraci√≥n de Nginx se estructura en bloques, entre los que est√°n los bloques de <code>server</code> donde iremos poniendo la configuraci√≥n de nuestros subdominios. Todos estos bloques <code>server</code> est√°n dentro de un bloque <code>http</code> en el archivo <code>/etc/nginx/nginx.conf</code>. Vamos a hacer unos cuantos cambios en ese archivo para mejorar la seguridad. As√≠ deber√≠a verse:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">user </span><span style="color:#E1E4E8;"> nginx;</span></span>
<span class="line"><span style="color:#F97583;">worker_processes </span><span style="color:#E1E4E8;"> auto;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">error_log </span><span style="color:#E1E4E8;"> /var/log/nginx/error.log</span><span style="color:#79B8FF;"> notice</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">pid </span><span style="color:#E1E4E8;">       /var/run/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">events</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> worker_connections </span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1024</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">http</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> add_header </span><span style="color:#E1E4E8;">Allow </span><span style="color:#9ECBFF;">&quot;GET, POST, OPTIONS&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> add_header </span><span style="color:#E1E4E8;">X-Permitted-Cross-Domain-Policies </span><span style="color:#9ECBFF;">&quot;none&quot;</span><span style="color:#E1E4E8;"> always;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> add_header </span><span style="color:#E1E4E8;">X-Content-Type-Options nosniff always;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> add_header </span><span style="color:#E1E4E8;">X-Frame-Options </span><span style="color:#9ECBFF;">&quot;SAMEORIGIN&quot;</span><span style="color:#E1E4E8;"> always;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> add_header </span><span style="color:#E1E4E8;">X-XSS-Protection </span><span style="color:#9ECBFF;">&quot;1; mode=block&quot;</span><span style="color:#E1E4E8;"> always;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> add_header </span><span style="color:#E1E4E8;">Referrer-Policy </span><span style="color:#9ECBFF;">&quot;strict-origin-when-cross-origin&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> add_header </span><span style="color:#E1E4E8;">Content-Security-Policy </span><span style="color:#9ECBFF;">&quot;default-src &#39;self&#39;;&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> add_header </span><span style="color:#E1E4E8;">Content-Security-Policy-Report-Only </span><span style="color:#9ECBFF;">&quot;default-src &#39;self&#39;;&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> add_header </span><span style="color:#E1E4E8;">Permissions-Policy </span><span style="color:#9ECBFF;">&quot;accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> add_header </span><span style="color:#E1E4E8;">Strict-Transport-Security </span><span style="color:#9ECBFF;">&quot;max-age=63072000; includeSubDomains; preload&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> fastcgi_hide_header </span><span style="color:#E1E4E8;">X-Powered-By;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> fastcgi_hide_header </span><span style="color:#E1E4E8;">Server;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> fastcgi_hide_header </span><span style="color:#E1E4E8;">X-AspNet-Version;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> fastcgi_hide_header </span><span style="color:#E1E4E8;">X-AspNetMvc-Version;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> fastcgi_hide_header </span><span style="color:#E1E4E8;">X-Pingback;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Set client_max_body_size and limit_rate</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> client_max_body_size </span><span style="color:#E1E4E8;">10m;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> limit_rate </span><span style="color:#E1E4E8;">8m;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> include </span><span style="color:#E1E4E8;">      /etc/nginx/mime.types;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> default_type </span><span style="color:#E1E4E8;"> application/octet-stream;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> log_format </span><span style="color:#79B8FF;"> main</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&#39;$</span><span style="color:#E1E4E8;">remote_addr</span><span style="color:#9ECBFF;"> - $</span><span style="color:#E1E4E8;">remote_user</span><span style="color:#9ECBFF;"> [$</span><span style="color:#E1E4E8;">time_local</span><span style="color:#9ECBFF;">] &#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">                      </span><span style="color:#9ECBFF;">&#39;&quot;$</span><span style="color:#E1E4E8;">request</span><span style="color:#9ECBFF;">&quot; $</span><span style="color:#E1E4E8;">status</span><span style="color:#9ECBFF;"> $</span><span style="color:#E1E4E8;">body_bytes_sent</span><span style="color:#9ECBFF;"> &#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">                      </span><span style="color:#9ECBFF;">&#39;&quot;$</span><span style="color:#E1E4E8;">http_referer</span><span style="color:#9ECBFF;">&quot; &quot;$</span><span style="color:#E1E4E8;">http_user_agent</span><span style="color:#9ECBFF;">&quot;&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> access_log </span><span style="color:#E1E4E8;"> /var/log/nginx/access.log </span><span style="color:#79B8FF;"> main</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Disable server tokens in response headers</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> server_tokens </span><span style="color:#E1E4E8;">off;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Enable SSL/TLS</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> ssl_protocols </span><span style="color:#E1E4E8;">TLSv1.3;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> ssl_session_cache </span><span style="color:#E1E4E8;">shared:le_nginx_SSL:10m;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> ssl_session_timeout </span><span style="color:#E1E4E8;">1d;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> ssl_session_tickets </span><span style="color:#E1E4E8;">off;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> ssl_ecdh_curve </span><span style="color:#E1E4E8;">secp384r1;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># OSCP</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> ssl_stapling </span><span style="color:#E1E4E8;">on;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> ssl_stapling_verify </span><span style="color:#E1E4E8;">on;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> resolver </span><span style="color:#E1E4E8;">208.67.222.222 </span><span style="color:#79B8FF;">208.67.220.220</span><span style="color:#E1E4E8;"> valid=300s;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> resolver_timeout </span><span style="color:#E1E4E8;">5s;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> ssl_trusted_certificate </span><span style="color:#E1E4E8;">/etc/letsencrypt/live/wupp.dev/chain.pem;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> sendfile </span><span style="color:#E1E4E8;">on;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> tcp_nopush </span><span style="color:#E1E4E8;">on;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> tcp_nodelay </span><span style="color:#E1E4E8;">on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> keepalive_timeout </span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">65</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#gzip  on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> include </span><span style="color:#E1E4E8;">/etc/nginx/conf.d/*.conf;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">user </span><span style="color:#24292E;"> nginx;</span></span>
<span class="line"><span style="color:#D73A49;">worker_processes </span><span style="color:#24292E;"> auto;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">error_log </span><span style="color:#24292E;"> /var/log/nginx/error.log</span><span style="color:#005CC5;"> notice</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">pid </span><span style="color:#24292E;">       /var/run/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">events</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> worker_connections </span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1024</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">http</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> add_header </span><span style="color:#24292E;">Allow </span><span style="color:#032F62;">&quot;GET, POST, OPTIONS&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> add_header </span><span style="color:#24292E;">X-Permitted-Cross-Domain-Policies </span><span style="color:#032F62;">&quot;none&quot;</span><span style="color:#24292E;"> always;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> add_header </span><span style="color:#24292E;">X-Content-Type-Options nosniff always;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> add_header </span><span style="color:#24292E;">X-Frame-Options </span><span style="color:#032F62;">&quot;SAMEORIGIN&quot;</span><span style="color:#24292E;"> always;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> add_header </span><span style="color:#24292E;">X-XSS-Protection </span><span style="color:#032F62;">&quot;1; mode=block&quot;</span><span style="color:#24292E;"> always;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> add_header </span><span style="color:#24292E;">Referrer-Policy </span><span style="color:#032F62;">&quot;strict-origin-when-cross-origin&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> add_header </span><span style="color:#24292E;">Content-Security-Policy </span><span style="color:#032F62;">&quot;default-src &#39;self&#39;;&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> add_header </span><span style="color:#24292E;">Content-Security-Policy-Report-Only </span><span style="color:#032F62;">&quot;default-src &#39;self&#39;;&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> add_header </span><span style="color:#24292E;">Permissions-Policy </span><span style="color:#032F62;">&quot;accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> add_header </span><span style="color:#24292E;">Strict-Transport-Security </span><span style="color:#032F62;">&quot;max-age=63072000; includeSubDomains; preload&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> fastcgi_hide_header </span><span style="color:#24292E;">X-Powered-By;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> fastcgi_hide_header </span><span style="color:#24292E;">Server;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> fastcgi_hide_header </span><span style="color:#24292E;">X-AspNet-Version;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> fastcgi_hide_header </span><span style="color:#24292E;">X-AspNetMvc-Version;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> fastcgi_hide_header </span><span style="color:#24292E;">X-Pingback;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Set client_max_body_size and limit_rate</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> client_max_body_size </span><span style="color:#24292E;">10m;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> limit_rate </span><span style="color:#24292E;">8m;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> include </span><span style="color:#24292E;">      /etc/nginx/mime.types;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> default_type </span><span style="color:#24292E;"> application/octet-stream;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> log_format </span><span style="color:#005CC5;"> main</span><span style="color:#24292E;">  </span><span style="color:#032F62;">&#39;$</span><span style="color:#24292E;">remote_addr</span><span style="color:#032F62;"> - $</span><span style="color:#24292E;">remote_user</span><span style="color:#032F62;"> [$</span><span style="color:#24292E;">time_local</span><span style="color:#032F62;">] &#39;</span></span>
<span class="line"><span style="color:#24292E;">                      </span><span style="color:#032F62;">&#39;&quot;$</span><span style="color:#24292E;">request</span><span style="color:#032F62;">&quot; $</span><span style="color:#24292E;">status</span><span style="color:#032F62;"> $</span><span style="color:#24292E;">body_bytes_sent</span><span style="color:#032F62;"> &#39;</span></span>
<span class="line"><span style="color:#24292E;">                      </span><span style="color:#032F62;">&#39;&quot;$</span><span style="color:#24292E;">http_referer</span><span style="color:#032F62;">&quot; &quot;$</span><span style="color:#24292E;">http_user_agent</span><span style="color:#032F62;">&quot;&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> access_log </span><span style="color:#24292E;"> /var/log/nginx/access.log </span><span style="color:#005CC5;"> main</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Disable server tokens in response headers</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> server_tokens </span><span style="color:#24292E;">off;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Enable SSL/TLS</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> ssl_protocols </span><span style="color:#24292E;">TLSv1.3;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> ssl_session_cache </span><span style="color:#24292E;">shared:le_nginx_SSL:10m;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> ssl_session_timeout </span><span style="color:#24292E;">1d;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> ssl_session_tickets </span><span style="color:#24292E;">off;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> ssl_ecdh_curve </span><span style="color:#24292E;">secp384r1;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># OSCP</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> ssl_stapling </span><span style="color:#24292E;">on;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> ssl_stapling_verify </span><span style="color:#24292E;">on;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> resolver </span><span style="color:#24292E;">208.67.222.222 </span><span style="color:#005CC5;">208.67.220.220</span><span style="color:#24292E;"> valid=300s;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> resolver_timeout </span><span style="color:#24292E;">5s;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> ssl_trusted_certificate </span><span style="color:#24292E;">/etc/letsencrypt/live/wupp.dev/chain.pem;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> sendfile </span><span style="color:#24292E;">on;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> tcp_nopush </span><span style="color:#24292E;">on;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> tcp_nodelay </span><span style="color:#24292E;">on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> keepalive_timeout </span><span style="color:#24292E;"> </span><span style="color:#005CC5;">65</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#gzip  on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> include </span><span style="color:#24292E;">/etc/nginx/conf.d/*.conf;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>Para saber qu√© hace cada cambio, puedes buscarlo en la documentaci√≥n de Nginx, porque por ahora me da pereza ponerlo aqu√≠.</p><div class="danger custom-block"><p class="custom-block-title">PELIGRO</p><p>Debes tener mucho cuidado al a√±adir <code>preload</code> a la cabecera de Strict-Transport-Security. Esto es algo que puede traerte problemitas si no conoces bien sus consecuencias. Para m√°s informaci√≥n puedes consultar <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html#strict-transport-security-hsts" target="_blank" rel="noreferrer">esta p√°gina</a>.</p></div><p>¬øC√≥mo hemos decidido poner estas opciones? Pues buscando entre varias p√°ginas recomendaciones. Aqu√≠ hay una lista de p√°ginas que hemos consultado:</p><ul><li><a href="https://ssl-config.mozilla.org/" target="_blank" rel="noreferrer">Generador de configuraci√≥n SSL de Mozilla</a></li><li><a href="https://wiki.mozilla.org/Security/Server_Side_TLS" target="_blank" rel="noreferrer">Recomendaciones de TLS de Mozilla</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP" target="_blank" rel="noreferrer">Gu√≠a de HTTP de Mozilla</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html" target="_blank" rel="noreferrer">Descripci√≥n de cada cabecera HTTP</a></li><li><a href="https://www.ssllabs.com/ssltest/analyze.html?d=cloud.wupp.dev" target="_blank" rel="noreferrer">Reportage de SSL Labs</a></li><li><a href="https://tlsprofiler.danielfett.de/" target="_blank" rel="noreferrer">Reportage de TLS Profiler</a></li></ul><p>Aun as√≠, no hemos seguido las recomendaciones de cada p√°gina al pie de la letra, hemos escogido lo que m√°s nos conven√≠a.</p><p>Despu√©s de esto, dentro de cada bloque <code>server</code> podremos o tendremos que hacer otros cambios, pero eso es algo espec√≠fico que iremos viendo.</p><p>Un cambio que s√≠ se puede hacer y que es √∫til si vamos a a√±adir varios subdominios (todos ellos con HTTPS), es crear un √∫nico bloque <code>server</code> que se encargue de redirigir todas las solicitudes HTTP a las respectivas HTTPS. Podemos crear un archivo <code>/etc/nginx/conf.d/wupp.dev</code> con el siguiente contenido:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">server</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> listen </span><span style="color:#E1E4E8;">80</span><span style="color:#79B8FF;"> default_server</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> server_name </span><span style="color:#E1E4E8;">wupp.dev;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">301</span><span style="color:#E1E4E8;"> https://$server_name$request_uri;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">server</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> listen </span><span style="color:#24292E;">80</span><span style="color:#005CC5;"> default_server</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> server_name </span><span style="color:#24292E;">wupp.dev;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">301</span><span style="color:#24292E;"> https://$server_name$request_uri;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>Y as√≠ el archivo <code>/etc/nginx/www.wupp.dev</code> quedar√≠a m√°s limpio:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">server</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> server_name </span><span style="color:#E1E4E8;">wupp.dev www.wupp.dev;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#access_log  /var/log/nginx/host.access.log  main;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">/ </span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#F97583;"> root </span><span style="color:#E1E4E8;">  /usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#F97583;"> index </span><span style="color:#E1E4E8;"> index.html index.htm;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#error_page  404              /404.html;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># redirect server error pages to the static page /50x.html</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> error_page </span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">500</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">502</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">503</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">504</span><span style="color:#E1E4E8;">  /50x.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">/50x.html </span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#F97583;"> root </span><span style="color:#E1E4E8;">  /usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> listen </span><span style="color:#E1E4E8;">443 ssl; </span><span style="color:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> ssl_certificate </span><span style="color:#E1E4E8;">/etc/letsencrypt/live/wupp.dev/fullchain.pem; </span><span style="color:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> ssl_certificate_key </span><span style="color:#E1E4E8;">/etc/letsencrypt/live/wupp.dev/privkey.pem; </span><span style="color:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> include </span><span style="color:#E1E4E8;">/etc/letsencrypt/options-ssl-nginx.conf; </span><span style="color:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;"> ssl_dhparam </span><span style="color:#E1E4E8;">/etc/letsencrypt/ssl-dhparams.pem; </span><span style="color:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">server</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> server_name </span><span style="color:#24292E;">wupp.dev www.wupp.dev;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#access_log  /var/log/nginx/host.access.log  main;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">location</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">/ </span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#D73A49;"> root </span><span style="color:#24292E;">  /usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#D73A49;"> index </span><span style="color:#24292E;"> index.html index.htm;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#error_page  404              /404.html;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># redirect server error pages to the static page /50x.html</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> error_page </span><span style="color:#24292E;">  </span><span style="color:#005CC5;">500</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">502</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">503</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">504</span><span style="color:#24292E;">  /50x.html;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">location</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/50x.html </span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#D73A49;"> root </span><span style="color:#24292E;">  /usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> listen </span><span style="color:#24292E;">443 ssl; </span><span style="color:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> ssl_certificate </span><span style="color:#24292E;">/etc/letsencrypt/live/wupp.dev/fullchain.pem; </span><span style="color:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> ssl_certificate_key </span><span style="color:#24292E;">/etc/letsencrypt/live/wupp.dev/privkey.pem; </span><span style="color:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> include </span><span style="color:#24292E;">/etc/letsencrypt/options-ssl-nginx.conf; </span><span style="color:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;"> ssl_dhparam </span><span style="color:#24292E;">/etc/letsencrypt/ssl-dhparams.pem; </span><span style="color:#6A737D;"># managed by Certbot</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>Un detalle importante al usar Certbot es que a√±ade autom√°ticamente esta l√≠nea a cada bloque <code>server</code> para el que genera certificado:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">include </span><span style="color:#E1E4E8;">/etc/letsencrypt/options-ssl-nginx.conf; </span><span style="color:#6A737D;"># managed by Certbot</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">include </span><span style="color:#24292E;">/etc/letsencrypt/options-ssl-nginx.conf; </span><span style="color:#6A737D;"># managed by Certbot</span></span></code></pre></div><p>Si vemos el contenido de este archivo, nos daremos cuenta de un ligero problema:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># This file contains important security parameters. If you modify this file</span></span>
<span class="line"><span style="color:#6A737D;"># manually, Certbot will be unable to automatically provide future security</span></span>
<span class="line"><span style="color:#6A737D;"># updates. Instead, Certbot will print and log an error message with a path to</span></span>
<span class="line"><span style="color:#6A737D;"># the up-to-date file that you will need to refer to when manually updating</span></span>
<span class="line"><span style="color:#6A737D;"># this file. Contents are based on https://ssl-config.mozilla.org</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">ssl_session_cache </span><span style="color:#E1E4E8;">shared:le_nginx_SSL:10m;</span></span>
<span class="line"><span style="color:#F97583;">ssl_session_timeout </span><span style="color:#E1E4E8;">1440m;</span></span>
<span class="line"><span style="color:#F97583;">ssl_session_tickets </span><span style="color:#E1E4E8;">off;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">ssl_protocols </span><span style="color:#E1E4E8;">TLSv1.2 TLSv1.3;</span></span>
<span class="line"><span style="color:#F97583;">ssl_prefer_server_ciphers </span><span style="color:#E1E4E8;">off;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">ssl_ciphers </span><span style="color:#9ECBFF;">&quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384&quot;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># This file contains important security parameters. If you modify this file</span></span>
<span class="line"><span style="color:#6A737D;"># manually, Certbot will be unable to automatically provide future security</span></span>
<span class="line"><span style="color:#6A737D;"># updates. Instead, Certbot will print and log an error message with a path to</span></span>
<span class="line"><span style="color:#6A737D;"># the up-to-date file that you will need to refer to when manually updating</span></span>
<span class="line"><span style="color:#6A737D;"># this file. Contents are based on https://ssl-config.mozilla.org</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">ssl_session_cache </span><span style="color:#24292E;">shared:le_nginx_SSL:10m;</span></span>
<span class="line"><span style="color:#D73A49;">ssl_session_timeout </span><span style="color:#24292E;">1440m;</span></span>
<span class="line"><span style="color:#D73A49;">ssl_session_tickets </span><span style="color:#24292E;">off;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">ssl_protocols </span><span style="color:#24292E;">TLSv1.2 TLSv1.3;</span></span>
<span class="line"><span style="color:#D73A49;">ssl_prefer_server_ciphers </span><span style="color:#24292E;">off;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">ssl_ciphers </span><span style="color:#032F62;">&quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384&quot;</span><span style="color:#24292E;">;</span></span></code></pre></div><p>Este archivo nos est√° sobreescribiendo algunos ajustes que hemos hecho, pero advierte que si lo modificamos dejar√° de actualizarse junto con Certbot, as√≠ que tenemos dos opciones:</p><ul><li>Dejar simplemente que Certbot elija y actualice la configuraci√≥n.</li><li>Cambiarla nosotros y asegurarnos de mantenerla en un futuro si surge alguna nueva recomendaci√≥n de seguridad.</li></ul><p>Como nosotros no estamos satisfechos con la configuraci√≥n actual de Certbot, hemos decidido cambiarla, quedando as√≠:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># This file contains important security parameters. If you modify this file</span></span>
<span class="line"><span style="color:#6A737D;"># manually, Certbot will be unable to automatically provide future security</span></span>
<span class="line"><span style="color:#6A737D;"># updates. Instead, Certbot will print and log an error message with a path to</span></span>
<span class="line"><span style="color:#6A737D;"># the up-to-date file that you will need to refer to when manually updating</span></span>
<span class="line"><span style="color:#6A737D;"># this file. Contents are based on https://ssl-config.mozilla.org</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">ssl_protocols </span><span style="color:#E1E4E8;">TLSv1.3;</span></span>
<span class="line"><span style="color:#F97583;">ssl_session_cache </span><span style="color:#E1E4E8;">shared:le_nginx_SSL:10m;</span></span>
<span class="line"><span style="color:#F97583;">ssl_session_timeout </span><span style="color:#E1E4E8;">1d;</span></span>
<span class="line"><span style="color:#F97583;">ssl_session_tickets </span><span style="color:#E1E4E8;">off;</span></span>
<span class="line"><span style="color:#F97583;">ssl_ecdh_curve </span><span style="color:#E1E4E8;">secp384r1;</span></span>
<span class="line"><span style="color:#F97583;">ssl_stapling </span><span style="color:#E1E4E8;">on;</span></span>
<span class="line"><span style="color:#F97583;">ssl_stapling_verify </span><span style="color:#E1E4E8;">on;</span></span>
<span class="line"><span style="color:#F97583;">resolver </span><span style="color:#E1E4E8;">208.67.222.222 </span><span style="color:#79B8FF;">208.67.220.220</span><span style="color:#E1E4E8;"> valid=300s;</span></span>
<span class="line"><span style="color:#F97583;">resolver_timeout </span><span style="color:#E1E4E8;">5s;</span></span>
<span class="line"><span style="color:#F97583;">ssl_trusted_certificate </span><span style="color:#E1E4E8;">/etc/letsencrypt/live/wupp.dev/chain.pem;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># This file contains important security parameters. If you modify this file</span></span>
<span class="line"><span style="color:#6A737D;"># manually, Certbot will be unable to automatically provide future security</span></span>
<span class="line"><span style="color:#6A737D;"># updates. Instead, Certbot will print and log an error message with a path to</span></span>
<span class="line"><span style="color:#6A737D;"># the up-to-date file that you will need to refer to when manually updating</span></span>
<span class="line"><span style="color:#6A737D;"># this file. Contents are based on https://ssl-config.mozilla.org</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">ssl_protocols </span><span style="color:#24292E;">TLSv1.3;</span></span>
<span class="line"><span style="color:#D73A49;">ssl_session_cache </span><span style="color:#24292E;">shared:le_nginx_SSL:10m;</span></span>
<span class="line"><span style="color:#D73A49;">ssl_session_timeout </span><span style="color:#24292E;">1d;</span></span>
<span class="line"><span style="color:#D73A49;">ssl_session_tickets </span><span style="color:#24292E;">off;</span></span>
<span class="line"><span style="color:#D73A49;">ssl_ecdh_curve </span><span style="color:#24292E;">secp384r1;</span></span>
<span class="line"><span style="color:#D73A49;">ssl_stapling </span><span style="color:#24292E;">on;</span></span>
<span class="line"><span style="color:#D73A49;">ssl_stapling_verify </span><span style="color:#24292E;">on;</span></span>
<span class="line"><span style="color:#D73A49;">resolver </span><span style="color:#24292E;">208.67.222.222 </span><span style="color:#005CC5;">208.67.220.220</span><span style="color:#24292E;"> valid=300s;</span></span>
<span class="line"><span style="color:#D73A49;">resolver_timeout </span><span style="color:#24292E;">5s;</span></span>
<span class="line"><span style="color:#D73A49;">ssl_trusted_certificate </span><span style="color:#24292E;">/etc/letsencrypt/live/wupp.dev/chain.pem;</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Entre todas las cosas que hemos a√±adido est√° el OCSP Stapling, pero no est√° implementado en su totalidad, pues se puede a√±adir la etiqueta &quot;OCSP Must-Staple&quot; al certificado del servidor, pero no es algo esencial y habr√≠a que volver a generar todos los certificados de nuevo. Puedes ver m√°s informaci√≥n <a href="https://scotthelme.co.uk/ocsp-must-staple/" target="_blank" rel="noreferrer">aqu√≠</a>.</p></div><p>Aunque ya hemos acabado de configurar Nginx, hay que tener en cuenta de que por ahora lo √∫nico que hace es servir archivos est√°ticos localizados en <code>/usr/share/nginx/html/</code>.</p><p>En un principio, nos dedicaremos a a√±adir servicios en subdominios, dejando <code>www</code> intacto, as√≠ que puede dejarse como una p√°gina web est√°tica, retocando un poco su apariencia o puede configurarse como uno de los servicios, eso ya queda a elecci√≥n de cada uno.</p><h3 id="para-el-dominio" tabindex="-1">Para el dominio <a class="header-anchor" href="#para-el-dominio" aria-label="Permalink to &quot;Para el dominio&quot;">‚Äã</a></h3><p>Entre la gran variedad de registros que podemos a√±adir a un dominio, est√° el Certificate Authority Authorization (CAA) con el que podemos indicar qu√© autoridades pueden crear certificados para el dominio y sus subdominios. Para configurarlo, simplemente a√±adimos el registro CAA bajo el dominio base <code>wupp.dev</code> y como destino indicamos <code>0 issue &quot;letsencrypt.org&quot;</code> para que solo se puedan crear certificados por letsencrypt.</p></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-ef5dee53><!--[--><!--]--><div class="edit-info" data-v-ef5dee53><!----><div class="last-updated" data-v-ef5dee53><p class="VPLastUpdated" data-v-ef5dee53 data-v-7de715c0>Actualizado por √∫ltima vez: <time datetime="2024-01-26T20:12:32.000Z" data-v-7de715c0></time></p></div></div><nav class="prev-next" data-v-ef5dee53><div class="pager" data-v-ef5dee53><a class="pager-link prev" href="/server/equipo/gestion-remota.html" data-v-ef5dee53><span class="desc" data-v-ef5dee53>Previous page</span><span class="title" data-v-ef5dee53>Gesti√≥n remota con SSH y VNC</span></a></div><div class="pager" data-v-ef5dee53><a class="pager-link next" href="/server/equipo/docker.html" data-v-ef5dee53><span class="desc" data-v-ef5dee53>Next page</span><span class="title" data-v-ef5dee53>Docker</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-1919c326 data-v-e03eb2e1><div class="container" data-v-e03eb2e1><p class="message" data-v-e03eb2e1>Distribuido bajo la licencia CC BY.</p><p class="copyright" data-v-e03eb2e1>Copyright ¬© 2022-presente Lucas de U√±a Ocampo e Iv√°n Salido Cobo</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"equipo_conectando-servidores.md\":\"02b9883d\",\"servicios_navidrome.md\":\"0d1e242d\",\"equipo_gestion-remota.md\":\"7b08b0ec\",\"servicios_gitea.md\":\"67e66e3d\",\"servicios_dozzle.md\":\"dfcf29aa\",\"servicios_homarr.md\":\"f949c8c3\",\"servicios_minecraft.md\":\"4d1fbdab\",\"servicios_minio.md\":\"0c3a1b12\",\"relatos_bloqueo-ssh.md\":\"dedff122\",\"equipo_hardware.md\":\"fe81f4c1\",\"equipo_docker.md\":\"fd183bb0\",\"index.md\":\"8a35cc4b\",\"shared_servicios_recordatorios-nginx.md\":\"4257fe3c\",\"servicios_uptime-kuma.md\":\"703418ee\",\"servicios_sharelatex.md\":\"5b438d78\",\"shared_servicios_puertos.md\":\"f42424da\",\"equipo_nginx.md\":\"dbed93a5\",\"servicios_authentik.md\":\"2c122868\",\"servicios_nextcloud.md\":\"f239ce27\",\"relatos_usuario-docker.md\":\"4ccf19b4\",\"servicios_docker-mailserver.md\":\"ae643c0c\",\"equipo_historia.md\":\"db1d7771\",\"relatos_dns-initramfs.md\":\"2a22ded8\",\"equipo_mariadb-docker.md\":\"15795a37\",\"servicios_mailserver.md\":\"851d539e\",\"equipo_sistema-encriptado.md\":\"a658c0ba\",\"equipo_router-dominio.md\":\"b3a0a4c5\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"es-ES\",\"dir\":\"ltr\",\"title\":\"Servidor mamad√≠simo\",\"description\":\"Gu√≠a del servidor.\",\"base\":\"/server/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"lastUpdatedText\":\"Actualizado por √∫ltima vez\",\"nav\":[{\"text\":\"Inicio\",\"link\":\"/\",\"activeMatch\":\"\"},{\"text\":\"Gu√≠a del servidor\",\"link\":\"/equipo/historia\",\"activeMatch\":\"/(equipo|servicios)/\"},{\"text\":\"Archivos de configuraci√≥n\",\"link\":\"https://github.com/wupp-dev/server\"}],\"socialLinks\":[{\"icon\":\"discord\",\"link\":\"https://discord.gg/2pdbaf6Ugz\"}],\"sidebar\":{\"/equipo/\":[{\"text\":\"Equipo\",\"collapsible\":true,\"items\":[{\"text\":\"Historia\",\"link\":\"/equipo/historia\"},{\"text\":\"Hardware\",\"link\":\"/equipo/hardware\"},{\"text\":\"Instalaci√≥n del SO encriptado\",\"link\":\"/equipo/sistema-encriptado\"},{\"text\":\"Configuraci√≥n del router y dominio\",\"link\":\"/equipo/router-dominio\"},{\"text\":\"Gesti√≥n remota con SSH y VNC\",\"link\":\"/equipo/gestion-remota\"},{\"text\":\"Nginx como servidor web\",\"link\":\"/equipo/nginx\"},{\"text\":\"Docker\",\"link\":\"/equipo/docker\"},{\"text\":\"Configurando MariaDB con Docker\",\"link\":\"/equipo/mariadb-docker\"},{\"text\":\"Conectando varios servidores\",\"link\":\"/equipo/conectando-servidores\"}]},{\"text\":\"Servicios\",\"collapsible\":true,\"items\":[{\"text\":\"Nextcloud - Almacenamiento\",\"link\":\"/servicios/nextcloud\"},{\"text\":\"Docker Mailserver - Correo electr√≥nico\",\"link\":\"/servicios/mailserver\"},{\"text\":\"Minio - Almacenamiento S3\",\"link\":\"/servicios/minio\"},{\"text\":\"Minecraft con AMP\",\"link\":\"/servicios/minecraft\"},{\"text\":\"Dozzle - Visualizador de logs\",\"link\":\"/servicios/dozzle\"},{\"text\":\"Homarr - Dashboard\",\"link\":\"/servicios/homarr\"},{\"text\":\"Uptime Kuma - Status\",\"link\":\"/servicios/uptime-kuma\"},{\"text\":\"Authentik - Autenticaci√≥n\",\"link\":\"/servicios/authentik\"},{\"text\":\"Gitea - Servicio git\",\"link\":\"/servicios/gogs\"},{\"text\":\"Navidrome - Streaming de m√∫sica\",\"link\":\"/servicios/navidrome\"},{\"text\":\"Overleaf - Editor de LaTeX\",\"link\":\"/servicios/sharelatex\"},{\"text\":\"Docker Mailserver - Servidor de correo\",\"link\":\"/servicios/docker-mailserver\"}]},{\"text\":\"Relatos\",\"collapsible\":true,\"items\":[{\"text\":\"Bloqueo de SSH\",\"link\":\"/relatos/bloqueo-ssh\"},{\"text\":\"Lucas vs. Debian & Docker & etc.\",\"link\":\"/relatos/usuario-docker\"},{\"text\":\"Resoluci√≥n de dominios en initramfs\",\"link\":\"/relatos/dns-initramfs\"}]}],\"/servicios/\":[{\"text\":\"Equipo\",\"collapsible\":true,\"items\":[{\"text\":\"Historia\",\"link\":\"/equipo/historia\"},{\"text\":\"Hardware\",\"link\":\"/equipo/hardware\"},{\"text\":\"Instalaci√≥n del SO encriptado\",\"link\":\"/equipo/sistema-encriptado\"},{\"text\":\"Configuraci√≥n del router y dominio\",\"link\":\"/equipo/router-dominio\"},{\"text\":\"Gesti√≥n remota con SSH y VNC\",\"link\":\"/equipo/gestion-remota\"},{\"text\":\"Nginx como servidor web\",\"link\":\"/equipo/nginx\"},{\"text\":\"Docker\",\"link\":\"/equipo/docker\"},{\"text\":\"Configurando MariaDB con Docker\",\"link\":\"/equipo/mariadb-docker\"},{\"text\":\"Conectando varios servidores\",\"link\":\"/equipo/conectando-servidores\"}]},{\"text\":\"Servicios\",\"collapsible\":true,\"items\":[{\"text\":\"Nextcloud - Almacenamiento\",\"link\":\"/servicios/nextcloud\"},{\"text\":\"Docker Mailserver - Correo electr√≥nico\",\"link\":\"/servicios/mailserver\"},{\"text\":\"Minio - Almacenamiento S3\",\"link\":\"/servicios/minio\"},{\"text\":\"Minecraft con AMP\",\"link\":\"/servicios/minecraft\"},{\"text\":\"Dozzle - Visualizador de logs\",\"link\":\"/servicios/dozzle\"},{\"text\":\"Homarr - Dashboard\",\"link\":\"/servicios/homarr\"},{\"text\":\"Uptime Kuma - Status\",\"link\":\"/servicios/uptime-kuma\"},{\"text\":\"Authentik - Autenticaci√≥n\",\"link\":\"/servicios/authentik\"},{\"text\":\"Gitea - Servicio git\",\"link\":\"/servicios/gogs\"},{\"text\":\"Navidrome - Streaming de m√∫sica\",\"link\":\"/servicios/navidrome\"},{\"text\":\"Overleaf - Editor de LaTeX\",\"link\":\"/servicios/sharelatex\"},{\"text\":\"Docker Mailserver - Servidor de correo\",\"link\":\"/servicios/docker-mailserver\"}]},{\"text\":\"Relatos\",\"collapsible\":true,\"items\":[{\"text\":\"Bloqueo de SSH\",\"link\":\"/relatos/bloqueo-ssh\"},{\"text\":\"Lucas vs. Debian & Docker & etc.\",\"link\":\"/relatos/usuario-docker\"},{\"text\":\"Resoluci√≥n de dominios en initramfs\",\"link\":\"/relatos/dns-initramfs\"}]}],\"/relatos/\":[{\"text\":\"Equipo\",\"collapsible\":true,\"items\":[{\"text\":\"Historia\",\"link\":\"/equipo/historia\"},{\"text\":\"Hardware\",\"link\":\"/equipo/hardware\"},{\"text\":\"Instalaci√≥n del SO encriptado\",\"link\":\"/equipo/sistema-encriptado\"},{\"text\":\"Configuraci√≥n del router y dominio\",\"link\":\"/equipo/router-dominio\"},{\"text\":\"Gesti√≥n remota con SSH y VNC\",\"link\":\"/equipo/gestion-remota\"},{\"text\":\"Nginx como servidor web\",\"link\":\"/equipo/nginx\"},{\"text\":\"Docker\",\"link\":\"/equipo/docker\"},{\"text\":\"Configurando MariaDB con Docker\",\"link\":\"/equipo/mariadb-docker\"},{\"text\":\"Conectando varios servidores\",\"link\":\"/equipo/conectando-servidores\"}]},{\"text\":\"Servicios\",\"collapsible\":true,\"items\":[{\"text\":\"Nextcloud - Almacenamiento\",\"link\":\"/servicios/nextcloud\"},{\"text\":\"Docker Mailserver - Correo electr√≥nico\",\"link\":\"/servicios/mailserver\"},{\"text\":\"Minio - Almacenamiento S3\",\"link\":\"/servicios/minio\"},{\"text\":\"Minecraft con AMP\",\"link\":\"/servicios/minecraft\"},{\"text\":\"Dozzle - Visualizador de logs\",\"link\":\"/servicios/dozzle\"},{\"text\":\"Homarr - Dashboard\",\"link\":\"/servicios/homarr\"},{\"text\":\"Uptime Kuma - Status\",\"link\":\"/servicios/uptime-kuma\"},{\"text\":\"Authentik - Autenticaci√≥n\",\"link\":\"/servicios/authentik\"},{\"text\":\"Gitea - Servicio git\",\"link\":\"/servicios/gogs\"},{\"text\":\"Navidrome - Streaming de m√∫sica\",\"link\":\"/servicios/navidrome\"},{\"text\":\"Overleaf - Editor de LaTeX\",\"link\":\"/servicios/sharelatex\"},{\"text\":\"Docker Mailserver - Servidor de correo\",\"link\":\"/servicios/docker-mailserver\"}]},{\"text\":\"Relatos\",\"collapsible\":true,\"items\":[{\"text\":\"Bloqueo de SSH\",\"link\":\"/relatos/bloqueo-ssh\"},{\"text\":\"Lucas vs. Debian & Docker & etc.\",\"link\":\"/relatos/usuario-docker\"},{\"text\":\"Resoluci√≥n de dominios en initramfs\",\"link\":\"/relatos/dns-initramfs\"}]}]},\"footer\":{\"message\":\"Distribuido bajo la licencia CC BY.\",\"copyright\":\"Copyright ¬© 2022-presente Lucas de U√±a Ocampo e Iv√°n Salido Cobo\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>