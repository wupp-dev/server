import{_ as a,c as e,o as s,N as n}from"./chunks/framework.c70b0f75.js";const C=JSON.parse('{"title":"Nginx como servidor web","description":"","frontmatter":{"title":"Nginx como servidor web","lang":"es-ES"},"headers":[],"relativePath":"equipo/nginx.md","lastUpdated":1678807577000}'),o={name:"equipo/nginx.md"},l=n(`<h1 id="nginx-como-servidor-web" tabindex="-1">Nginx como servidor web <a class="header-anchor" href="#nginx-como-servidor-web" aria-label="Permalink to &quot;Nginx como servidor web&quot;">‚Äã</a></h1><p>Ya nos hemos encargado de poder acceder al servidor remotamente, pero eso es solo para nosotros, queda la parte m√°s importante, el poder ofrecer alg√∫n tipo de servicio <em>(como puede ser una p√°gina web)</em>.</p><p>Para ello, necesitamos un servidor web, que se encargar√° de gestionar las conexiones entrantes.</p><h2 id="instalacion-y-puesta-en-marcha" tabindex="-1">Instalaci√≥n y puesta en marcha <a class="header-anchor" href="#instalacion-y-puesta-en-marcha" aria-label="Permalink to &quot;Instalaci√≥n y puesta en marcha&quot;">‚Äã</a></h2><p>Para asegurarnos de tener la √∫ltima versi√≥n siempre instalada, utilizaremos los repositorios de Nginx en vez de los del sistema operativo. Para a√±adirlos, podemos seguir los pasos de <a href="https://nginx.org/en/linux_packages.html#Debian" target="_blank" rel="noreferrer">su web</a>, que para Debian son:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ sudo apt install curl gnupg2 ca-certificates lsb-release debian-archive-keyring</span></span>
<span class="line"><span style="color:#A6ACCD;">$ curl https://nginx.org/keys/nginx_signing.key | gpg --dearmor \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null</span></span>
<span class="line"><span style="color:#A6ACCD;">$ gpg --dry-run --quiet --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Con este √∫ltimo comando verificamos que la clave es la correcta, deber√≠a mostrarse lo siguiente:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">pub   rsa2048 2011-08-19 [SC] [expires: 2024-06-14]</span></span>
<span class="line"><span style="color:#A6ACCD;">      573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62</span></span>
<span class="line"><span style="color:#A6ACCD;">uid                      nginx signing key &lt;signing-key@nginx.com&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Nosotros hemos escogido usar los paquetes <strong>mainline</strong> en vez de los <strong>stable</strong>, la diferencia es que los primeros contienen las √∫ltimas novedades aunque pueden ser menos estables por tener caracter√≠sticas experimentales. Para a√±adir el repositorio mainline, utilizamos el siguiente comando:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ echo &quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\</span></span>
<span class="line"><span style="color:#A6ACCD;">http://nginx.org/packages/mainline/debian \`lsb_release -cs\` nginx&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    | sudo tee /etc/apt/sources.list.d/nginx.list</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Y ya ha llegado el momento de instalar Nginx:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ sudo apt update</span></span>
<span class="line"><span style="color:#A6ACCD;">$ sudo apt install nginx</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Una vez instalado, podemos iniciarlo y verificar que est√° funcionando correctamente:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ sudo systemctl start nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">$ sudo systemctl status nginx</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Sin embargo, queda un √∫ltimo paso, permitir los puertos <code>80</code> y <code>443</code> tanto en el rotuer como en el firewall, para el firewall escribimos:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ sudo ufw allow 80</span></span>
<span class="line"><span style="color:#A6ACCD;">$ sudo ufw allow 443</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Estos son los puertos de HTTP y HTTPS respectivamente.</p><p>Vamos a hacer retocar un poco la configuraci√≥n para las partes venideras de la gu√≠a. La configuraci√≥n de Nginx se estructura en bloques. Concretamente la parte que tocaremos son los bloques <code>server</code>, que ser√°n la configuraci√≥n de cada uno de nuestros subdominios. Estos archvios de configuraci√≥n se guardan en <code>/etc/nginx/conf.d/</code> y, por defecto, solo habr√° un archivo llamado <code>default.conf</code>, vamos a cambiarle el nombre a <code>wupp.dev</code>, ya que tendr√° el bloque encargado de gestionar las conexiones con esa URL.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/wupp.dev.conf</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Editamos el archivo y buscamos una l√≠nea que empiece por <code>server_name</code>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">server_name wupp.dev www.wupp.dev;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Ahora verificamos que el archivo modificado verifique la sint√°xis y reiniciamos el servicio de Nginx:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ sudo nginx -t</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx: configuration file /etc/nginx/nginx.conf test is successful</span></span>
<span class="line"><span style="color:#A6ACCD;">$ sudo systemctl reload nginx</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="habilitando-y-forzando-https" tabindex="-1">Habilitando <em>(y forzando)</em> HTTPS <a class="header-anchor" href="#habilitando-y-forzando-https" aria-label="Permalink to &quot;Habilitando *(y forzando)* HTTPS&quot;">‚Äã</a></h2><p>Ahora mismo podemos poner en el navegador <a href="http://wupp.dev/" target="_blank" rel="noreferrer">wupp.dev</a>, pero la conexi√≥n no es segura üò¶</p><p>Eso es inadmisible, as√≠ que vamos a forzar a que todas las conexiones HTTP se redirijan a HTTPS. Hemos seguido <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-20-04-es" target="_blank" rel="noreferrer">este tutorial</a>.</p><p>Vamos a utilizar Certbot, un software para gestionar los certificados de Let&#39;s Encrypt, que son <a href="https://es.wikipedia.org/wiki/Autoridad_de_certificaci%C3%B3n" target="_blank" rel="noreferrer">certificados de autoridad</a> gratuitos.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ sudo apt install certbot python3-certbot-nginx</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Generamos el certificado para nuestro dominio:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ sudo certbot --nginx -d wupp.dev -d www.wupp.dev</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Y ya est√°, certbot se encarga de modificar la configuraci√≥n del archivo <code>/etc/nginx/conf.d/wupp.dev.conf</code> para forzar el uso de HTTPS y para renovar autom√°ticamente los certificados cuando vayan a expirar.</p><h2 id="otras-mejoras-de-seguridad" tabindex="-1">Otras mejoras de seguridad <a class="header-anchor" href="#otras-mejoras-de-seguridad" aria-label="Permalink to &quot;Otras mejoras de seguridad&quot;">‚Äã</a></h2><p>--- POR HACER ---</p>`,33),i=[l];function t(r,p,c,d,u,g){return s(),e("div",null,i)}const h=a(o,[["render",t]]);export{C as __pageData,h as default};
