import{_ as o,c as a,o as s,ak as d}from"./chunks/framework.BKdJk6yS.js";const u=JSON.parse('{"title":"Moviendo /var a otro disco","description":"","frontmatter":{"order":5},"headers":[],"relativePath":"relatos/moviendo-var.md","filePath":"relatos/moviendo-var.md","lastUpdated":1767570319000}'),n={name:"relatos/moviendo-var.md"};function i(c,e,r,t,l,p){return s(),a("div",null,[...e[0]||(e[0]=[d(`<h1 id="moviendo-var-a-otro-disco" tabindex="-1">Moviendo /var a otro disco <a class="header-anchor" href="#moviendo-var-a-otro-disco" aria-label="Permalink to “Moviendo /var a otro disco”">​</a></h1><p>Optamos por mover toda la carpeta <code>/var</code> al disco duro grande por ser una carpeta donde se suelen almacenar logs y archivos más pesados. Para ello, montaremos directamente el disco grande en <code>/var</code>.</p><p>Empezamos copiando todo el contenido al disco duro con <code>sudo cp -rf /var/* /mnt/vault/</code>. Después modificamos <code>/etc/fstab</code> para cambiar el punto de montaje del disco duro de <code>/mnt/vault</code> a <code>/var</code> y tenemos que reiniciar <em>daemon</em> de <em>systemclt</em> con <code>sudo systemctl daemon-reload</code>. Ahora podemos mover la actual carpeta a una copia y mantenerla durante un tiempo prudencial <code>sudo mv /var /var.old</code>, creamos la nueva carpeta <code>sudo mkdir /var</code> y remontamos el disco duro con <code>sudo umount /mnt/vault</code> y <code>sudo mount /dev/mapper/vault</code>.</p><p>Si después de esto obtuviésemos un error al usar <code>apt</code> similar a:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>/usr/bin/mandb: can&#39;t chmod /var/cache/man/CACHEDIR.TAG: Operation not permitted</span></span>
<span class="line"><span>/usr/bin/mandb: can&#39;t remove /var/cache/man/CACHEDIR.TAG: Permission denied</span></span>
<span class="line"><span>/usr/bin/mandb: fopen /var/cache/man/28371: Permission denied</span></span></code></pre></div><p>Podemos solucionarlo con <code>chown -R man: /var/cache/man/</code> y <code>chmod -R 755 /var/cache/man/</code>.</p><p>También es posible que, después de eso, nos encontremos con que el servicio <code>lighdm</code> falla (posiblemente después de un reinicio). Lo podemos solucionar con <code>sudo chown -R lightdm:lightdm /var/lib/lightdm/</code> y <code>sudo chmod -R 755 /var/lib/lightdm/</code>.</p><p>Otra de las cosas que pueden ocurrir es que el servicio <code>binfmt-support</code> falle también después de un reinicio. Lo podemos solucionar con <code>mkdir /etc/systemd/system/binfmt-support.service.d</code> y creando el archivo <code>/etc/systemd/system/binfmt-support.service.d/override.conf</code> con:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>[Unit]</span></span>
<span class="line"><span>RequiresMountsFor=/var</span></span></code></pre></div><p>Que hará que el servicio se inicie una vez se haya montado la partición <code>/var</code>.</p>`,10)])])}const v=o(n,[["render",i]]);export{u as __pageData,v as default};
